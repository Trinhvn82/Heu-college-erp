{% load static %}

<!DOCTYPE html>
<html lang="vi">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <title>{% block title %}H·ªá th·ªëng Qu·∫£n l√Ω Nh√† tr·ªç{% endblock %}</title>
    
    <meta name="description" content="Gi·∫£i ph√°p qu·∫£n l√Ω nh√† tr·ªç to√†n di·ªán, d·ªÖ d√†ng v√† hi·ªáu qu·∫£">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèòÔ∏è</text></svg>">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ffffff">

    <!-- Volt CSS -->
    <link type="text/css" href="{% static 'assets/css/volt.css' %}" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

    {% block extra_css %}{% endblock %}
</head>

<body>
    {% block header_nav %}
    <!-- Simple Header for Landing -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" href="{% url 'renter_landing' %}">
                <span class="fas fa-home me-2"></span>
                Qu·∫£n l√Ω Nh√† tr·ªç
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    {% if user.is_authenticated %}
                        <li class="nav-item">
                            <a class="nav-link" href="/">
                                <span class="fas fa-home me-1"></span>Trang ch·ªß
                            </a>
                        </li>
                        <li class="nav-item dropdown">
                            {% load user_display %}
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <span class="fas fa-user me-1"></span>{% display_name user %}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="{% url 'changepwd' %}">
                                    <span class="fas fa-key me-2"></span>ƒê·ªïi m·∫≠t kh·∫©u
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="{% url 'logout' %}">
                                    <span class="fas fa-sign-out-alt me-2"></span>ƒêƒÉng xu·∫•t
                                </a></li>
                            </ul>
                        </li>
                        
                    {% else %}
                        <li class="nav-item">
                            <a class="btn btn-primary" href="{% url 'login' %}">
                                <span class="fas fa-sign-in-alt me-1"></span>ƒêƒÉng nh·∫≠p
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>
    {% endblock header_nav %}

    <!-- Main Content -->
    {% block content %}{% endblock %}

    <!-- Simple Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5 class="fw-bold">H·ªá th·ªëng Qu·∫£n l√Ω Nh√† tr·ªç</h5>
                    <p class="text-muted small">Gi·∫£i ph√°p to√†n di·ªán cho vi·ªác qu·∫£n l√Ω nh√† tr·ªç hi·ªáu qu·∫£</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small text-muted mb-0">&copy; 2025 OpenApps. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Core JS -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Smooth scroll -->
    <script src="{% static 'assets/vendor/smooth-scroll/dist/smooth-scroll.polyfills.min.js' %}"></script>

    <!-- Volt JS -->
    <script src="{% static 'assets/js/volt.js' %}"></script>

    <script>
        // Add red asterisk to labels of required fields on public pages
        document.addEventListener('DOMContentLoaded', function() {
            try {
                var requiredFields = document.querySelectorAll('form input[required], form select[required], form textarea[required]');
                requiredFields.forEach(function(el) {
                    if (!el.id) return;
                    var label = document.querySelector('label[for="' + el.id + '"]');
                    if (label && !label.querySelector('.required-asterisk')) {
                        var star = document.createElement('span');
                        star.className = 'required-asterisk text-danger ms-1';
                        star.textContent = '*';
                        label.appendChild(star);
                    }
                });
            } catch (e) {
                // ignore
            }
        });

        // Handle session timeout - refresh page when form is focused after long inactivity
        // This ensures fresh CSRF token is loaded
        (function() {
            let lastActivity = Date.now();
            // Landing page (unauthenticated or generic) uses owner timeout baseline (5 minutes)
            const SESSION_TIMEOUT = 5 * 60 * 1000; // 5 minutes in milliseconds
            
            // Update last activity on any user interaction
            ['mousedown', 'keydown', 'scroll', 'touchstart'].forEach(function(event) {
                document.addEventListener(event, function() {
                    lastActivity = Date.now();
                }, true);
            });
            
            // Check for timeout when form elements are focused
            document.addEventListener('focusin', function(e) {
                if (e.target.matches('input, textarea, select')) {
                    const timeSinceLastActivity = Date.now() - lastActivity;
                    if (timeSinceLastActivity > SESSION_TIMEOUT) {
                        // Session likely expired, reload page to get fresh CSRF token
                        console.log('Session timeout detected, refreshing page...');
                        window.location.reload();
                    }
                }
            }, true);
        })();
    </script>

    {% block extra_js %}{% endblock %}
</body>

</html>

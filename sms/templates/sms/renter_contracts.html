{% extends 'layouts/renter_base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Hợp đồng - Khách thuê{% endblock %}

{% block extra_css %}
<style>
    .contracts-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 15px;
        padding: 2rem;
        color: white;
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }
    
    .stat-card {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        transition: all 0.3s;
        border-left: 4px solid;
    }
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }
    .stat-card.total { border-left-color: #6c757d; }
    .stat-card.active { border-left-color: #28a745; }
    .stat-card.expired { border-left-color: #dc3545; }
    
    .stat-number {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    .stat-label {
        color: #6c757d;
        font-size: 0.9rem;
        font-weight: 500;
    }
    
    .contract-card {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        transition: all 0.3s;
        margin-bottom: 2rem;
        cursor: pointer;
    }
    .contract-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    .contract-header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 1.5rem;
        position: relative;
    }
    
    .contract-header.expired {
        background: linear-gradient(135deg, #868f96 0%, #596164 100%);
    }
    
    .contract-body {
        padding: 1.5rem;
        display: none;
    }
    
    .contract-body.show {
        display: block;
    }
    
    .info-row {
        display: flex;
        align-items: flex-start;
        margin-bottom: 1rem;
        padding: 0.75rem;
        background: #f8f9fa;
        border-radius: 8px;
    }
    
    .info-icon {
        width: 35px;
        color: #667eea;
        font-size: 1.2rem;
    }
    
    .info-content {
        flex: 1;
    }
    
    .info-label {
        font-weight: 600;
        color: #495057;
        font-size: 0.9rem;
        margin-bottom: 0.25rem;
    }
    
    .info-value {
        color: #212529;
        font-size: 1rem;
    }
    
    .house-detail-card {
        background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
        border-radius: 10px;
        padding: 1.5rem;
        margin-top: 1.5rem;
    }
    
    .amenity-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 1rem;
        background: white;
        border-radius: 20px;
        margin: 0.25rem;
        font-size: 0.85rem;
    }
    
    .amenity-badge i {
        margin-right: 0.5rem;
    }
    
    .toggle-icon {
        position: absolute;
        right: 1.5rem;
        top: 50%;
        transform: translateY(-50%);
        transition: transform 0.3s;
    }
    
    .contract-card.expanded .toggle-icon {
        transform: translateY(-50%) rotate(180deg);
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="contracts-header">
        <h1 class="mb-0">
            <span class="fas fa-file-contract me-3"></span>
            Hợp đồng của tôi
        </h1>
        <p class="mb-0 mt-2 opacity-75">Danh sách các hợp đồng thuê nhà</p>
    </div>

    <!-- Statistics -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="stat-card total">
                <div class="stat-number text-secondary">{{ total_contracts }}</div>
                <div class="stat-label">Tổng số hợp đồng</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card active">
                <div class="stat-number text-success">{{ active_contracts }}</div>
                <div class="stat-label">Đang thuê</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card expired">
                <div class="stat-number text-danger">{{ expired_contracts }}</div>
                <div class="stat-label">Không khả dụng</div>
            </div>
        </div>
    </div>

    <!-- Contracts List -->
    {% if contracts %}
        {% for contract in contracts %}
        <div class="contract-card {% if not contract.active %}expired{% endif %}" data-contract-id="{{ contract.id }}">
            <div class="contract-header {% if not contract.active %}expired{% endif %}">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h4 class="mb-2">
                            <span class="fas fa-home me-2"></span>
                            {{ contract.house.ten }}
                        </h4>
                        <p class="mb-0 opacity-75">
                            <span class="fas fa-map-marker-alt me-2"></span>
                            {{ contract.house.loc.diachi }}
                        </p>
                    </div>
                    <div class="text-end">
                        {% if contract.active %}
                            <span class="badge bg-success fs-6 px-3 py-2">
                                <span class="fas fa-check-circle me-1"></span>
                                Đang thuê
                            </span>
                        {% else %}
                            <span class="badge bg-secondary fs-6 px-3 py-2">
                                <span class="fas fa-times-circle me-1"></span>
                                Không khả dụng
                            </span>
                        {% endif %}
                    </div>
                </div>
                <span class="toggle-icon">
                    <i class="fas fa-chevron-down fa-lg"></i>
                </span>
            </div>
            
            <div class="contract-body">
                <!-- Contract Information -->
                <h5 class="mb-3">
                    <span class="fas fa-file-contract me-2 text-primary"></span>
                    Thông tin hợp đồng
                </h5>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="info-row">
                            <span class="info-icon fas fa-calendar-check"></span>
                            <div class="info-content">
                                <div class="info-label">Ngày bắt đầu</div>
                                <div class="info-value">{{ contract.rent_from|date:"d/m/Y" }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-row">
                            <span class="info-icon fas fa-calendar-times"></span>
                            <div class="info-content">
                                <div class="info-label">Ngày kết thúc</div>
                                <div class="info-value">{{ contract.rent_to|date:"d/m/Y" }}</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                {% if contract.ghichu %}
                <div class="info-row">
                    <span class="info-icon fas fa-sticky-note"></span>
                    <div class="info-content">
                        <div class="info-label">Ghi chú</div>
                        <div class="info-value">{{ contract.ghichu }}</div>
                    </div>
                </div>
                {% endif %}

                <!-- House Details -->
                <div class="house-detail-card">
                    <h5 class="mb-3">
                        <span class="fas fa-home me-2"></span>
                        Thông tin phòng trọ
                    </h5>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-row bg-white">
                                <span class="info-icon fas fa-home"></span>
                                <div class="info-content">
                                    <div class="info-label">Tên phòng</div>
                                    <div class="info-value">{{ contract.house.ten }}</div>
                                </div>
                            </div>
                            <div class="info-row bg-white">
                                <span class="info-icon fas fa-map-marker-alt"></span>
                                <div class="info-content">
                                    <div class="info-label">Địa chỉ</div>
                                    <div class="info-value">{{ contract.house.loc.diachi }}</div>
                                </div>
                            </div>
                            <div class="info-row bg-white">
                                <span class="info-icon fas fa-building"></span>
                                <div class="info-content">
                                    <div class="info-label">Loại nhà</div>
                                    <div class="info-value">{{ contract.house.loainha }}</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-row bg-white">
                                <span class="info-icon fas fa-ruler-combined"></span>
                                <div class="info-content">
                                    <div class="info-label">Diện tích</div>
                                    <div class="info-value">{{ contract.house.dientich }} m²</div>
                                </div>
                            </div>
                            <div class="info-row bg-white">
                                <span class="info-icon fas fa-dollar-sign"></span>
                                <div class="info-content">
                                    <div class="info-label">Giá thuê/tháng</div>
                                    <div class="info-value">{{ contract.house.permonth|floatformat:0|intcomma }} VNĐ</div>
                                </div>
                            </div>
                            <div class="info-row bg-white">
                                <span class="info-icon fas fa-piggy-bank"></span>
                                <div class="info-content">
                                    <div class="info-label">Tiền cọc</div>
                                    <div class="info-value">{{ contract.house.deposit|floatformat:0|intcomma }} VNĐ</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Amenities -->
                    <div class="mt-3">
                        <div class="info-label mb-2">
                            <span class="fas fa-star me-1"></span>
                            Tiện nghi
                        </div>
                        <div>
                            {% if contract.house.kitchen %}
                            <span class="amenity-badge">
                                <i class="fas fa-utensils text-success"></i>
                                Bếp
                            </span>
                            {% endif %}
                            {% if contract.house.wc %}
                            <span class="amenity-badge">
                                <i class="fas fa-toilet text-success"></i>
                                Nhà vệ sinh
                            </span>
                            {% endif %}
                            {% if contract.house.aircondition %}
                            <span class="amenity-badge">
                                <i class="fas fa-fan text-success"></i>
                                Điều hòa
                            </span>
                            {% endif %}
                            {% if contract.house.wifi %}
                            <span class="amenity-badge">
                                <i class="fas fa-wifi text-success"></i>
                                Wifi
                            </span>
                            {% endif %}
                            {% if contract.house.washingmachine %}
                            <span class="amenity-badge">
                                <i class="fas fa-jug-detergent text-success"></i>
                                Máy giặt
                            </span>
                            {% endif %}
                        </div>
                    </div>

                    {% if contract.house.ghichu %}
                    <div class="mt-3">
                        <div class="info-row bg-white">
                            <span class="info-icon fas fa-comment"></span>
                            <div class="info-content">
                                <div class="info-label">Ghi chú về phòng</div>
                                <div class="info-value">{{ contract.house.ghichu }}</div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Landlord Info -->
                <div class="mt-3">
                    <h5 class="mb-3">
                        <span class="fas fa-user-tie me-2 text-primary"></span>
                        Thông tin chủ nhà
                    </h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-row">
                                <span class="info-icon fas fa-user"></span>
                                <div class="info-content">
                                    <div class="info-label">Họ tên</div>
                                    {% load user_display %}
                                    <div class="info-value">{% display_name contract.house.loc.chu %}</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            {% if contract.house.loc.chu.email %}
                            <div class="info-row">
                                <span class="info-icon fas fa-envelope"></span>
                                <div class="info-content">
                                    <div class="info-label">Email</div>
                                    <div class="info-value">{{ contract.house.loc.chu.email }}</div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% if contract.house.loc.chu.phone %}
                    <div class="info-row">
                        <span class="info-icon fas fa-phone"></span>
                        <div class="info-content">
                            <div class="info-label">Số điện thoại</div>
                            <div class="info-value">{{ contract.house.loc.chu.phone }}</div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="text-center py-5">
            <span class="fas fa-file-contract fa-3x text-muted mb-3 d-block"></span>
            <h5 class="text-muted">Chưa có hợp đồng nào</h5>
            <p class="text-muted">Bạn chưa có hợp đồng thuê nhà nào</p>
        </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Toggle contract details
    document.querySelectorAll('.contract-card').forEach(card => {
        card.querySelector('.contract-header').addEventListener('click', function(e) {
            e.preventDefault();
            const body = card.querySelector('.contract-body');
            const isExpanded = body.classList.contains('show');
            
            // Close all other cards
            document.querySelectorAll('.contract-card').forEach(otherCard => {
                otherCard.classList.remove('expanded');
                otherCard.querySelector('.contract-body').classList.remove('show');
            });
            
            // Toggle current card
            if (!isExpanded) {
                card.classList.add('expanded');
                body.classList.add('show');
            }
        });
    });
});
</script>
{% endblock %}
